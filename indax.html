<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Online Medicine Shop | অনলাইন মেডিসিন শপ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #1e8449;
      --primary-light: #27ae60;
      --primary-dark: #186a3b;
      --secondary: #3498db;
      --danger: #e74c3c;
      --warning: #f39c12;
      --light: #f5f7fa;
      --dark: #222;
      --gray: #666;
      --white: #fff;
      --shadow: 0 2px 10px rgba(0,0,0,0.08);
      --radius: 10px;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body { 
      font-family: "Noto Sans Bengali", "Segoe UI", sans-serif; 
      margin:0; 
      background: var(--light); 
      color: var(--dark);
      line-height: 1.6;
    }
    
    header {
      background: var(--white);
      padding: 14px 18px;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo i {
      font-size: 24px;
      color: var(--primary);
    }
    
    header h1 {
      margin: 0;
      font-size: 18px;
      color: var(--primary);
    }
    
    .controls {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .controls input, .controls select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: var(--radius);
      font-family: inherit;
    }
    
    .btn {
      background: var(--primary);
      color: var(--white);
      border: none;
      padding: 8px 16px;
      border-radius: var(--radius);
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: var(--secondary);
    }
    
    .btn-secondary:hover {
      background: #2980b9;
    }
    
    .btn-whatsapp {
      background: #25D366;
    }
    
    .btn-whatsapp:hover {
      background: #128C7E;
    }
    
    .btn-danger {
      background: var(--danger);
    }
    
    .btn-danger:hover {
      background: #c0392b;
    }
    
    .admin-link {
      text-decoration: none;
      color: var(--primary);
      margin-left: 8px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    
    main {
      max-width: 1200px;
      margin: 22px auto;
      padding: 0 18px;
    }
    
    .welcome-section {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 30px;
      border-radius: var(--radius);
      margin-bottom: 30px;
      text-align: center;
      box-shadow: var(--shadow);
    }
    
    .welcome-section h2 {
      margin-top: 0;
      font-size: 28px;
    }
    
    .welcome-section p {
      font-size: 16px;
      max-width: 700px;
      margin: 0 auto 20px;
    }
    
    .features {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }
    
    .feature {
      background: rgba(255,255,255,0.2);
      padding: 15px;
      border-radius: var(--radius);
      width: 180px;
      text-align: center;
    }
    
    .feature i {
      font-size: 24px;
      margin-bottom: 10px;
    }
    
    .section-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #ddd;
    }
    
    .products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .card {
      background: var(--white);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: transform 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
    }
    
    .card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      background: #eee;
    }
    
    .card .body {
      padding: 15px;
    }
    
    .card h3 {
      margin: 0 0 8px;
      font-size: 16px;
      color: var(--dark);
    }
    
    .card p {
      margin: 0 0 10px;
      color: var(--gray);
      font-size: 14px;
    }
    
    .meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .meta .price {
      font-weight: 700;
      color: var(--primary);
      font-size: 18px;
    }
    
    .card-buttons {
      display: flex;
      gap: 8px;
    }
    
    .card-buttons button {
      padding: 6px 12px;
      font-size: 13px;
    }
    
    form.order {
      background: var(--white);
      padding: 25px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-top: 30px;
    }
    
    form.order h3 {
      margin-top: 0;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .form-row {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .form-group {
      flex: 1;
    }
    
    form.order label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }
    
    form.order input, form.order textarea, form.order select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: var(--radius);
      font-family: inherit;
    }
    
    .whatsapp-order {
      background: #f0f9f0;
      border-left: 4px solid var(--primary);
      padding: 15px;
      margin: 20px 0;
      border-radius: 4px;
    }
    
    footer {
      max-width: 1200px;
      margin: 40px auto 20px;
      padding: 20px 18px;
      background: var(--white);
      border-radius: var(--radius);
      text-align: center;
      color: var(--gray);
      box-shadow: var(--shadow);
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 15px 0;
    }
    
    .footer-links a {
      color: var(--primary);
      text-decoration: none;
    }
    
    .small {
      font-size: 12px;
      color: var(--gray);
    }
    
    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: 0;
      }
      
      .features {
        flex-direction: column;
        align-items: center;
      }
      
      .feature {
        width: 100%;
        max-width: 300px;
      }
      
      header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }
      
      .controls {
        width: 100%;
        justify-content: space-between;
      }
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background: white;
      padding: 25px;
      border-radius: var(--radius);
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .close {
      font-size: 24px;
      cursor: pointer;
    }
    
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
    
    .cart-total {
      font-weight: bold;
      font-size: 18px;
      text-align: right;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 2px solid #eee;
    }
    
    .empty-cart {
      text-align: center;
      padding: 20px;
      color: var(--gray);
    }

    /* New CSS for non-intrusive notification */
    .toast-notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--primary-dark);
      color: var(--white);
      padding: 10px 15px;
      border-radius: var(--radius);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.5s, visibility 0.5s;
      z-index: 2000;
      font-size: 14px;
      box-shadow: var(--shadow);
    }
    
    .toast-notification.show {
      opacity: 1;
      visibility: visible;
    }
    
    /* Product details modal */
    .product-details {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .product-details img {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: var(--radius);
    }
    
    .product-details h3 {
      margin: 0;
      color: var(--primary);
    }
    
    .product-details .price {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary);
    }
    
    .product-details .description {
      color: var(--gray);
    }
    
    .product-details .actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    /* Loading indicator */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Order confirmation */
    .order-confirmation {
      text-align: center;
      padding: 20px;
    }
    
    .order-confirmation i {
      font-size: 48px;
      color: var(--primary);
      margin-bottom: 15px;
    }
    
    .order-confirmation h3 {
      color: var(--primary);
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <i class="fas fa-pills"></i>
      <h1>Online Medicine Shop | অনলাইন মেডিসিন শপ</h1>
    </div>
    <div class="controls">
      <input id="search" placeholder="Search / সার্চ করুন..." />
      <select id="filter">
        <option value="all">All / সব</option>
        <option value="medicine">Medicine / মেডিসিন</option>
        <option value="supplement">Supplement / সাপ্লিমেন্ট</option>
        <option value="device">Device / ডিভাইস</option>
      </select>
      <button class="btn" onclick="showCartModal()">
        <i class="fas fa-shopping-cart"></i> Cart / কার্ট (<span id="cartCount">0</span>)
      </button>
      <a href="admin.html" class="admin-link">
        <i class="fas fa-lock"></i> Admin Login
      </a>
    </div>
  </header>

  <main>
    <section class="welcome-section">
      <h2>স্বাগতম! Welcome to Our Online Medicine Shop</h2>
      <p>আপনার স্বাস্থ্য সুরক্ষায় আমরা আছি ২৪/৭। সকল ধরনের মেডিসিন, ভিটামিন ও মেডিকেল ডিভাইস পাবেন আমাদের কাছে।</p>
      <p>We are here for your health protection 24/7. Find all types of medicines, vitamins and medical devices with us.</p>
      
      <div class="features">
        <div class="feature">
          <i class="fas fa-shipping-fast"></i>
          <div>Fast Delivery</div>
          <div>দ্রুত ডেলিভারি</div>
        </div>
        <div class="feature">
          <i class="fas fa-pills"></i>
          <div>Genuine Products</div>
          <div>অরিজিনাল প্রোডাক্ট</div>
        </div>
        <div class="feature">
          <i class="fas fa-headset"></i>
          <div>24/7 Support</div>
          <div>২৪/৭ সাপোর্ট</div>
        </div>
      </div>
    </section>

    <div class="section-title">
      <h2><i class="fas fa-boxes"></i> Products / প্রোডাক্ট সমূহ</h2>
      <div class="small" id="productCount">0 products found</div>
    </div>
    
    <div id="productList" class="products"></div>

    <form id="orderForm" class="order">
      <h3><i class="fas fa-shopping-bag"></i> Order Now / এখন অর্ডার করুন</h3>
      
      <div class="form-row">
        <div class="form-group">
          <label for="o_name">Name / নাম</label>
          <input id="o_name" placeholder="Your full name / আপনার পূর্ণ নাম" required />
        </div>
        <div class="form-group">
          <label for="o_phone">Phone / ফোন</label>
          <input id="o_phone" placeholder="Your phone number / আপনার ফোন নম্বর" required />
        </div>
      </div>
      
      <div class="form-group">
        <label for="o_address">Address / ঠিকানা</label>
        <textarea id="o_address" placeholder="Your full address / আপনার সম্পূর্ণ ঠিকানা" rows="3" required></textarea>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="o_product">Select Product / প্রোডাক্ট নির্বাচন করুন</label>
          <select id="o_product" required>
            <option value="">Select product / প্রোডাক্ট নির্বাচন করুন</option>
          </select>
        </div>
        <div class="form-group">
          <label for="o_payment">Payment Method / পেমেন্ট মাধ্যম</label>
          <select id="o_payment" required>
            <option value="cod">Cash on Delivery / ক্যাশ অন ডেলিভারি</option>
            <option value="bkash">Bkash / বিকাশ</option>
            <option value="card">Card / কার্ড</option>
          </select>
        </div>
      </div>
      
      <button type="submit" class="btn">
        <i class="fas fa-paper-plane"></i> Submit Order / অর্ডার পাঠান
      </button>
      
      <div class="whatsapp-order">
        <p><strong>দ্রুত অর্ডারের জন্য:</strong> সরাসরি WhatsApp এ অর্ডার করুন</p>
        <p><strong>For quick order:</strong> Order directly on WhatsApp</p>
        <button type="button" class="btn btn-whatsapp" onclick="sendOrderViaWhatsApp()">
          <i class="fab fa-whatsapp"></i> Order on WhatsApp / WhatsApp এ অর্ডার করুন
        </button>
      </div>
      
      <p class="small">Note: The order will be sent to WhatsApp. / অর্ডারটি WhatsApp এ পাঠানো হবে।</p>
    </form>
  </main>

  <div id="cartModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-shopping-cart"></i> Your Cart / আপনার কার্ট</h3>
        <span class="close" onclick="closeCartModal()">&times;</span>
      </div>
      <div id="cartItems"></div>
      <div class="cart-total" id="cartTotal">Total: ৳0</div>
      <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
        <button class="btn" onclick="closeCartModal()">Continue Shopping</button>
        <button class="btn btn-secondary" onclick="checkout()">Checkout</button>
      </div>
    </div>
  </div>

  <div id="productModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-info-circle"></i> Product Details</h3>
        <span class="close" onclick="closeProductModal()">&times;</span>
      </div>
      <div id="productDetails"></div>
    </div>
  </div>

  <div id="orderConfirmationModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-check-circle"></i> Order Confirmation</h3>
        <span class="close" onclick="closeOrderConfirmationModal()">&times;</span>
      </div>
      <div class="order-confirmation">
        <i class="fas fa-check-circle"></i>
        <h3>Thank You for Your Order!</h3>
        <p>Your order has been placed successfully.</p>
        <p>আপনার অর্ডার সফলভাবে দেওয়া হয়েছে।</p>
        <p>We will contact you shortly for confirmation.</p>
        <p>আমরা শীঘ্রই নিশ্চিতকরণের জন্য আপনার সাথে যোগাযোগ করব।</p>
        <button class="btn" onclick="closeOrderConfirmationModal()">Continue Shopping</button>
      </div>
    </div>
  </div>

  <div id="toastNotification" class="toast-notification"></div>

  <footer>
    <div class="footer-links">
      <a href="#"><i class="fas fa-phone"></i> Contact Us</a>
      <a href="#"><i class="fas fa-info-circle"></i> About Us</a>
      <a href="#"><i class="fas fa-shield-alt"></i> Privacy Policy</a>
    </div>
    © <span id="year"></span> Online Medicine Shop | অনলাইন মেডিসিন শপ
    <p class="small">Your trusted online medicine provider / আপনার বিশ্বস্ত অনলাইন মেডিসিন সরবরাহকারী</p>
  </footer>

  <script>
    const STORAGE_KEY = "medProducts_v1";
    const ORDER_KEY = "medOrders_v1";
    // UPDATED WHATSAPP NUMBER
    const WHATSAPP_NUMBER = "01708708347"; 

    const seed = [
      {id:1, name:"Paracetamol 500mg | প্যারাসিটামল", type:"medicine", price:45, desc:"Fever & pain relief | জ্বর ও ব্যথা কমায়", img:"https://images.unsplash.com/photo-1582719478250-0b8a8f7ef83a?auto=format&fit=crop&w=600&q=60"},
      {id:2, name:"Vitamin C Tablet | ভিটামিন সি ট্যাবলেট", type:"supplement", price:200, desc:"Boosts immunity | রোগ প্রতিরোধ ক্ষমতা বাড়ায়", img:"https://images.unsplash.com/photo-1580281657525-7a8f9a8b8b59?auto=format&fit=crop&w=600&q=60"},
      {id:3, name:"Glucometer | গ্লুকোমিটার", type:"device", price:2500, desc:"Measures blood sugar | রক্তে শর্করা মাপার যন্ত্র", img:"https://images.unsplash.com/photo-1580281657520-1b8f9a1b9c12?auto=format&fit=crop&w=600&q=60"},
      {id:4, name:"Aspirin 75mg | অ্যাসপিরিন", type:"medicine", price:35, desc:"Blood thinner and pain relief | রক্ত পাতলা ও ব্যথা কমায়", img:"https://images.unsplash.com/photo-1584308666744-24d5c474f2ae?auto=format&fit=crop&w=600&q=60"},
      {id:5, name:"Vitamin D3 | ভিটামিন ডি৩", type:"supplement", price:180, desc:"Bone health and immunity | হাড়ের স্বাস্থ্য ও রোগ প্রতিরোধ", img:"https://images.unsplash.com/photo-1582719478393-6bbe10b2a6b7?auto=format&fit=crop&w=600&q=60"},
      {id:6, name:"Blood Pressure Monitor | ব্লাড প্রেশার মনিটর", type:"device", price:3200, desc:"Digital blood pressure monitor | ডিজিটাল ব্লাড প্রেশার মনিটর", img:"https://images.unsplash.com/photo-1559757148-5c350d0d3c56?auto=format&fit=crop&w=600&q=60"}
    ];

    function getProducts(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(seed));
        return seed.slice();
      }
      try{ return JSON.parse(raw); }catch(e){ return seed.slice(); }
    }

    function saveProducts(list){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
    }

    function renderProducts(){
      const list = getProducts();
      const container = document.getElementById("productList");
      container.innerHTML = "";
      const q = document.getElementById("search").value.toLowerCase();
      const f = document.getElementById("filter").value;
      const sel = document.getElementById("o_product");
      sel.innerHTML = '<option value="">Select product / প্রোডাক্ট নির্বাচন করুন</option>';

      const filtered = list.filter(p=>{
        const okFilter = f === "all" || p.type === f;
        const okQuery = p.name.toLowerCase().includes(q) || (p.desc && p.desc.toLowerCase().includes(q));
        return okFilter && okQuery;
      });

      document.getElementById("productCount").textContent = `${filtered.length} products found`;

      if(filtered.length === 0){
        container.innerHTML = '<div style="grid-column:1/-1;text-align:center;padding:40px;color:#666"><i class="fas fa-search" style="font-size:40px;margin-bottom:15px;"></i><p>No products found / কোনো প্রোডাক্ট পাওয়া যায়নি</p></div>';
        return;
      }

      filtered.forEach(p=>{
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${p.img || ''}" alt="${p.name}" />
          <div class="body">
            <h3>${p.name}</h3>
            <p>${p.desc || ''}</p>
            <div class="meta">
              <div class="price">৳${p.price}</div>
              <div class="card-buttons">
                <button class="btn" onclick="addToCart(${p.id})"><i class="fas fa-cart-plus"></i> Add</button>
                <button class="btn btn-secondary" onclick="viewDetails(${p.id})"><i class="fas fa-info-circle"></i> Details</button>
              </div>
            </div>
          </div>
        `;
        container.appendChild(card);

        const opt = document.createElement("option");
        opt.value = p.id;
        opt.textContent = `${p.name} — ৳${p.price}`;
        sel.appendChild(opt);
      });
    }

    let cart = JSON.parse(localStorage.getItem('medCart')) || [];
    
    // FUNCTION MODIFIED: REMOVED ALERT AND ADDED TOAST
    function addToCart(id){
      const prods = getProducts();
      const p = prods.find(x=>x.id === id);
      if(!p) return;
      const ex = cart.find(i=>i.id===id);
      if(ex) ex.qty++;
      else cart.push({id:p.id,name:p.name,price:p.price,qty:1});
      updateCartCount();
      saveCart();
      // Non-intrusive notification
      showToast(`${p.name} added to cart / কার্টে যোগ করা হয়েছে`);
    }

    function showToast(message) {
      const toast = document.getElementById('toastNotification');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000); 
    }
    
    function updateCartCount(){
      const count = cart.reduce((s,i)=>s+i.qty,0);
      document.getElementById("cartCount").textContent = count;
    }
    
    function saveCart() {
      localStorage.setItem('medCart', JSON.stringify(cart));
    }
    
    function showCartModal(){
      const modal = document.getElementById("cartModal");
      const cartItems = document.getElementById("cartItems");
      const cartTotal = document.getElementById("cartTotal");
      
      if(cart.length === 0) {
        cartItems.innerHTML = '<div class="empty-cart"><i class="fas fa-shopping-cart" style="font-size:40px;margin-bottom:15px;"></i><p>Your cart is empty / আপনার কার্ট খালি</p></div>';
        cartTotal.textContent = "Total: ৳0";
      } else {
        cartItems.innerHTML = '';
        let total = 0;
        
        cart.forEach(item => {
          const itemTotal = item.price * item.qty;
          total += itemTotal;
          
          const cartItem = document.createElement("div");
          cartItem.className = "cart-item";
          cartItem.innerHTML = `
            <div>
              <div><strong>${item.name}</strong></div>
              <div class="small">৳${item.price} x ${item.qty} = ৳${itemTotal}</div>
            </div>
            <div>
              <button class="btn" style="padding:4px 8px;font-size:12px;" onclick="updateCartItem(${item.id}, ${item.qty - 1})">-</button>
              <span style="margin:0 8px">${item.qty}</span>
              <button class="btn" style="padding:4px 8px;font-size:12px;" onclick="updateCartItem(${item.id}, ${item.qty + 1})">+</button>
              <button class="btn btn-danger" style="padding:4px 8px;font-size:12px;margin-left:8px" onclick="removeFromCart(${item.id})"><i class="fas fa-trash"></i></button>
            </div>
          `;
          cartItems.appendChild(cartItem);
        });
        
        cartTotal.textContent = `Total: ৳${total}`;
      }
      
      modal.style.display = "flex";
    }
    
    function closeCartModal() {
      document.getElementById("cartModal").style.display = "none";
    }
    
    function updateCartItem(id, newQty) {
      if (newQty < 1) {
        removeFromCart(id);
        return;
      }
      
      const item = cart.find(i => i.id === id);
      if (item) {
        item.qty = newQty;
        saveCart();
        updateCartCount();
        showCartModal();
      }
    }
    
    function removeFromCart(id) {
      cart = cart.filter(i => i.id !== id);
      saveCart();
      updateCartCount();
      showCartModal();
    }
    
    function checkout() {
      if (cart.length === 0) return;
      closeCartModal();
      document.getElementById('orderForm').scrollIntoView({ behavior: 'smooth' });
    }

    function viewDetails(id){
      const p = getProducts().find(x=>x.id===id);
      if(!p) return;
      
      const modal = document.getElementById("productModal");
      const details = document.getElementById("productDetails");
      
      details.innerHTML = `
        <div class="product-details">
          <img src="${p.img || ''}" alt="${p.name}" />
          <h3>${p.name}</h3>
          <div class="price">৳${p.price}</div>
          <div class="description">${p.desc || ''}</div>
          <div class="actions">
            <button class="btn" onclick="addToCart(${p.id}); closeProductModal();">
              <i class="fas fa-cart-plus"></i> Add to Cart
            </button>
            <button class="btn btn-secondary" onclick="closeProductModal()">
              Close
            </button>
          </div>
        </div>
      `;
      
      modal.style.display = "flex";
    }
    
    function closeProductModal() {
      document.getElementById("productModal").style.display = "none";
    }
    
    function closeOrderConfirmationModal() {
      document.getElementById("orderConfirmationModal").style.display = "none";
    }

    // New function to handle both "Submit Order" and "Order on WhatsApp" buttons
    function sendOrderViaWhatsApp() {
      const name = document.getElementById("o_name").value.trim();
      const phone = document.getElementById("o_phone").value.trim();
      const address = document.getElementById("o_address").value.trim();
      const productId = document.getElementById("o_product").value;
      const payment = document.getElementById("o_payment").value;
      
      if(!name || !phone || !address || !productId) {
        alert("Please fill all required fields / দয়া করে সব প্রয়োজনীয় তথ্য দিন");
        return;
      }
      
      const prods = getProducts();
      const prod = prods.find(p=>String(p.id) === String(productId));

      const paymentMethodText = document.getElementById("o_payment").options[document.getElementById("o_payment").selectedIndex].text;
      
      let message = `Hello! I would like to order:\n\n`;
      message += `Product: ${prod.name}\n`;
      message += `Price: ৳${prod.price}\n`;
      message += `Payment Method: ${paymentMethodText}\n\n`;
      message += `My Details:\n`;
      message += `Name: ${name}\n`;
      message += `Phone: ${phone}\n`;
      message += `Address: ${address}\n\n`;
      message += `Please confirm my order.`;
      
      const encodedMessage = encodeURIComponent(message);
      const whatsappURL = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`;
      
      window.open(whatsappURL, '_blank');

      // Clear the form after redirection
      document.getElementById("orderForm").reset();
      cart = [];
      updateCartCount();
      saveCart();
      
      // Show order confirmation modal
      document.getElementById("orderConfirmationModal").style.display = "flex";
    }
    
    // MODIFIED EVENT LISTENER: Form submission now calls sendOrderViaWhatsApp()
    document.getElementById("orderForm").addEventListener("submit", function(e){
      e.preventDefault();
      sendOrderViaWhatsApp();
    });

    document.getElementById("search").addEventListener("input", renderProducts);
    document.getElementById("filter").addEventListener("change", renderProducts);

    window.addEventListener('click', function(event) {
      const modal = document.getElementById('cartModal');
      if (event.target === modal) {
        closeCartModal();
      }
      
      const productModal = document.getElementById('productModal');
      if (event.target === productModal) {
        closeProductModal();
      }
      
      const orderConfirmationModal = document.getElementById('orderConfirmationModal');
      if (event.target === orderConfirmationModal) {
        closeOrderConfirmationModal();
      }
    });

    document.getElementById("year").textContent = new Date().getFullYear();
    renderProducts();
    updateCartCount();
  </script>
</body>
</html>
